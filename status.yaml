schema_version: "1.0"
project:
  name: "Inventory Management System (MVP)"
  description_ref: "DESCRIPTION.md"
  roadmap_ref: "ROADMAP.md"
  rules_ref: "RULES.md"
  sync_protocol_ref: "SYNC-PROTOCOL.md"

stack:
  backend:
    language: "Python"
    framework: "FastAPI"
    database: "SQLite"
    orm: "SQLAlchemy"
    migrations: "Alembic"
    auth: "JWT in HttpOnly cookie"
  frontend:
    framework: "React or Vue (TBD)"
    api_client: "fetch or axios (TBD)"

status_history:
  - status_id: "status-0001"
    timestamp_tashkent: "2026-01-20T00:00:00+05:00"
    current_position:
      chapter_id: "CHAPTER 1"
      stage_id: "STAGE 1.1"
      stage_title: "Repository & Workspace Setup"
    done:
      summary: []
      details: []
    next_actions_current_stage:
      - "Create monorepo structure: backend/ and frontend/"
      - "Initialize Git repository and add .gitignore"
      - "Add .env.example and minimal README"
    dod_evidence:
      - "No evidence yet (project not started)."
    decisions:
      - "Backend stack selected: FastAPI + SQLAlchemy + Alembic + SQLite."
      - "Frontend stack will be React or Vue (not decided yet)."
      - "Auth approach planned: JWT stored in HttpOnly cookie."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 0
      chapters_completed: 0
  - status_id: "status-0002"
    timestamp_tashkent: "2026-01-20T14:40:00+05:00"
    current_position:
      chapter_id: "CHAPTER 1"
      stage_id: "STAGE 1.2"
      stage_title: "Backend Skeleton (FastAPI)"
    done:
      summary:
        - "Created monorepo structure with backend/ and frontend/ directories."
        - "Added .gitignore, .env.example, and expanded README."
      details:
        - "Initialized repository layout in project root."
        - "Defined environment variable template for app name, secret, DB, and frontend origin."
        - "Documented features and stack in README."
    next_actions_current_stage:
      - "Create FastAPI app entry point."
      - "Add health check endpoint (GET /ping)."
      - "Configure settings module (app name, secret key, DB URL)."
      - "Enable CORS for frontend origin."
    dod_evidence:
      - "backend/ and frontend/ directories present."
      - ".gitignore and .env.example added in repo root."
      - "README updated with project description and features."
    decisions:
      - "Monorepo structure chosen: backend/ + frontend/."
      - "Environment template uses APP_NAME, SECRET_KEY, DATABASE_URL, FRONTEND_ORIGIN."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 1
      chapters_completed: 0
  - status_id: "status-0003"
    timestamp_tashkent: "2026-01-20T14:51:00+05:00"
    current_position:
      chapter_id: "CHAPTER 1"
      stage_id: "STAGE 1.3"
      stage_title: "Database Setup"
    done:
      summary:
        - "Created FastAPI app entry point with CORS enabled."
        - "Added settings module for app configuration."
        - "Implemented health check endpoint."
      details:
        - "FastAPI app initialized with CORS for frontend origin."
        - "Settings read from .env with defaults for app name, secret, DB, and frontend origin."
        - "Health check available at GET /ping."
    next_actions_current_stage:
      - "Configure SQLAlchemy engine + session."
      - "Initialize Alembic migrations."
      - "Create base database structure."
    dod_evidence:
      - "backend/app/main.py created with FastAPI app, CORS, and /ping."
      - "backend/app/core/config.py created with Settings and .env loading."
      - "backend/app/__init__.py created."
    decisions:
      - "FastAPI app uses CORS with single allowed frontend origin from settings."
      - "Settings are loaded via Pydantic BaseSettings."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 2
      chapters_completed: 0
  - status_id: "status-0004"
    timestamp_tashkent: "2026-01-20T15:06:00+05:00"
    current_position:
      chapter_id: "CHAPTER 2"
      stage_id: "STAGE 2.1"
      stage_title: "User Model"
    done:
      summary:
        - "Configured SQLAlchemy engine/session and declarative base."
        - "Initialized Alembic configuration and environment."
        - "Added backend requirements list."
      details:
        - "Created backend/app/db/base.py and backend/app/db/session.py with engine, SessionLocal, and SQLite connect args."
        - "Added backend/alembic.ini, backend/alembic/env.py, backend/alembic/script.py.mako, and backend/alembic/versions/.gitkeep."
        - "Added backend/requirements.txt with core backend dependencies."
    next_actions_current_stage:
      - "Implement User database model."
      - "Add password hashing utilities."
      - "Create admin/owner seed user logic."
    dod_evidence:
      - "backend/app/db/base.py created with declarative Base."
      - "backend/app/db/session.py created with engine and SessionLocal."
      - "backend/alembic.ini created."
      - "backend/alembic/env.py created."
      - "backend/alembic/script.py.mako created."
      - "backend/alembic/versions/.gitkeep created."
      - "backend/requirements.txt created."
    decisions:
      - "SQLAlchemy engine uses sqlite check_same_thread=False when database URL starts with sqlite."
      - "Alembic environment loads database URL from application settings."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 3
      chapters_completed: 1
  - status_id: "status-0005"
    timestamp_tashkent: "2026-01-20T15:16:00+05:00"
    current_position:
      chapter_id: "CHAPTER 2"
      stage_id: "STAGE 2.2"
      stage_title: "Login API"
    done:
      summary:
        - "Implemented User model for authentication."
        - "Added password hashing utilities."
        - "Added admin seed helper and admin credentials config."
      details:
        - "Created backend/app/models/user.py with users table and fields."
        - "Added backend/app/core/security.py with pbkdf2_hmac hashing and verification."
        - "Added backend/app/db/seed.py to create admin user if missing."
        - "Extended backend/app/core/config.py and .env.example with admin credentials."
    next_actions_current_stage:
      - "Implement POST /auth/login."
      - "Issue authentication token (JWT) and store in cookie (HttpOnly)."
      - "Implement GET /auth/me for session validation."
      - "Implement POST /auth/logout to clear authentication cookie."
    dod_evidence:
      - "backend/app/models/user.py created."
      - "backend/app/core/security.py created."
      - "backend/app/db/seed.py created."
      - "backend/app/core/config.py updated with admin credentials."
      - ".env.example updated with admin credentials."
    decisions:
      - "Password hashing uses pbkdf2_hmac with per-user salt."
      - "Admin account seeding is provided via ensure_admin_user helper."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 4
      chapters_completed: 1
  - status_id: "status-0006"
    timestamp_tashkent: "2026-01-20T15:23:00+05:00"
    current_position:
      chapter_id: "CHAPTER 2"
      stage_id: "STAGE 2.3"
      stage_title: "Protected API Access"
    done:
      summary:
        - "Implemented login API with JWT in HttpOnly cookie."
        - "Added session validation and logout endpoints."
        - "Added JWT utilities and request authentication dependency."
      details:
        - "Added backend/app/api/auth.py with /auth/login, /auth/me, /auth/logout."
        - "Added backend/app/core/jwt.py for token creation/decoding and backend/app/core/auth.py for current user dependency."
        - "Added backend/app/db/deps.py for DB session dependency and auth schemas in backend/app/schemas/auth.py."
        - "Extended settings and .env.example with token expiry and added PyJWT dependency."
    next_actions_current_stage:
      - "Create backend dependency for authenticated requests."
      - "Protect all business endpoints behind login."
    dod_evidence:
      - "backend/app/api/auth.py created."
      - "backend/app/core/jwt.py created."
      - "backend/app/core/auth.py created."
      - "backend/app/schemas/auth.py created."
      - "backend/app/main.py updated to include auth router."
      - "backend/requirements.txt updated with PyJWT."
      - "Manual check: .venv/bin/python -c \"from app.db.session import engine; print(engine)\" => Engine(sqlite:///./app.db)."
      - "Manual check: .venv/bin/alembic -c alembic.ini current => Alembic context initialized without errors."
      - "Manual check: .venv/bin/uvicorn app.main:app failed to bind on 127.0.0.1:8000 (port already in use)."
    decisions:
      - "JWT is stored in HttpOnly cookie named access_token."
      - "Token expiration is configurable via ACCESS_TOKEN_EXPIRE_MINUTES."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 5
      chapters_completed: 1
  - status_id: "status-0007"
    timestamp_tashkent: "2026-01-20T15:27:00+05:00"
    current_position:
      chapter_id: "CHAPTER 3"
      stage_id: "STAGE 3.1"
      stage_title: "Product Model"
    done:
      summary:
        - "Added protected router scaffold for authenticated business APIs."
      details:
        - "Created backend/app/api/protected.py with APIRouter dependency on get_current_user."
    next_actions_current_stage:
      - "Implement Product model."
      - "Include per-product low-stock threshold (min_stock)."
      - "Include product-level low-stock enable flag (low_stock_enabled)."
      - "Add soft-delete support (active/inactive)."
    dod_evidence:
      - "backend/app/api/protected.py created."
    decisions:
      - "Business endpoints will use a shared router with get_current_user dependency."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 6
      chapters_completed: 1
  - status_id: "status-0008"
    timestamp_tashkent: "2026-01-20T15:32:36+05:00"
    current_position:
      chapter_id: "CHAPTER 3"
      stage_id: "STAGE 3.2"
      stage_title: "Product CRUD API"
    done:
      summary:
        - "Implemented Product model with low-stock and active flags."
      details:
        - "Added Product SQLAlchemy model with name, unit, min_stock, low_stock_enabled, and is_active fields."
        - "Registered models import for Alembic metadata discovery."
    next_actions_current_stage:
      - "Implement product create endpoint."
      - "Implement product update endpoint."
      - "Implement product delete/deactivate endpoint."
      - "Implement product list endpoint with pagination."
    dod_evidence:
      - "backend/app/models/product.py created."
      - "backend/app/models/__init__.py updated to export Product."
      - "backend/alembic/env.py updated to import app.models."
    decisions:
      - "Product model uses is_active for soft delete and low_stock_enabled to control alerts."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 7
      chapters_completed: 1
  - status_id: "status-0009"
    timestamp_tashkent: "2026-01-20T15:36:57+05:00"
    current_position:
      chapter_id: "CHAPTER 3"
      stage_id: "STAGE 3.3"
      stage_title: "Search Support"
    done:
      summary:
        - "Added Product CRUD API with pagination."
      details:
        - "Implemented create, update, list, and deactivate endpoints under /products."
        - "Added Product request/response schemas with pagination wrapper."
        - "Protected product routes behind authentication dependency."
    next_actions_current_stage:
      - "Add product search by name to list endpoint."
      - "Validate search behavior (case-insensitive, partial match)."
    dod_evidence:
      - "backend/app/api/products.py created with POST/PUT/DELETE/GET endpoints."
      - "backend/app/schemas/product.py created."
      - "backend/app/schemas/__init__.py updated with product schemas."
      - "backend/app/main.py updated to include products router."
    decisions:
      - "Product list endpoint returns paginated items with total, skip, and limit."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 8
      chapters_completed: 1
  - status_id: "status-0010"
    timestamp_tashkent: "2026-01-20T15:37:37+05:00"
    current_position:
      chapter_id: "CHAPTER 4"
      stage_id: "STAGE 4.1"
      stage_title: "Movement Model"
    done:
      summary:
        - "Added product search by name to the list endpoint."
      details:
        - "List endpoint supports case-insensitive partial matching via query parameter."
    next_actions_current_stage:
      - "Implement StockMovement model."
      - "Support movement types: IN and OUT."
      - "Store quantity, timestamp, optional note, created_by."
    dod_evidence:
      - "backend/app/api/products.py updated with search filter on name."
    decisions:
      - "Search uses case-insensitive partial match."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 9
      chapters_completed: 1
  - status_id: "status-0011"
    timestamp_tashkent: "2026-01-20T15:43:14+05:00"
    current_position:
      chapter_id: "CHAPTER 4"
      stage_id: "STAGE 4.2"
      stage_title: "Movement API"
    done:
      summary:
        - "Implemented StockMovement model."
      details:
        - "Added stock_movements table with product_id, movement_type, quantity, note, created_by, and created_at."
    next_actions_current_stage:
      - "Implement POST /movements to create incoming/outgoing movements."
      - "Implement GET /movements list endpoint with basic filters."
    dod_evidence:
      - "backend/app/models/stock_movement.py created."
      - "backend/app/models/__init__.py updated to export StockMovement."
    decisions:
      - "Stock movements reference products and users via foreign keys."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 10
      chapters_completed: 1
  - status_id: "status-0012"
    timestamp_tashkent: "2026-01-20T15:44:26+05:00"
    current_position:
      chapter_id: "CHAPTER 4"
      stage_id: "STAGE 4.3"
      stage_title: "Balance Calculation Service"
    done:
      summary:
        - "Implemented stock movement API with basic filters."
      details:
        - "Added POST /movements to create IN/OUT movements."
        - "Added GET /movements with optional product_id and movement_type filters and pagination."
        - "Added movement schemas for create/list responses."
    next_actions_current_stage:
      - "Implement balance calculation logic: total(IN) − total(OUT)."
      - "Provide a backend function to compute balance per product."
      - "Ensure products with no movements return balance = 0."
    dod_evidence:
      - "backend/app/api/movements.py created."
      - "backend/app/schemas/movement.py created."
      - "backend/app/schemas/__init__.py updated with movement schemas."
      - "backend/app/main.py updated to include movements router."
    decisions:
      - "Movement list supports basic filters and pagination."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 11
      chapters_completed: 1
  - status_id: "status-0013"
    timestamp_tashkent: "2026-01-20T15:45:15+05:00"
    current_position:
      chapter_id: "CHAPTER 5"
      stage_id: "STAGE 5.1"
      stage_title: "Stock Overview API"
    done:
      summary:
        - "Implemented balance calculation service."
      details:
        - "Added helper to compute per-product balance as total(IN) minus total(OUT)."
        - "Returns zero balance for products with no movements."
    next_actions_current_stage:
      - "Implement GET /stock/overview endpoint returning product fields + balance + low-stock flag."
      - "Support search, low-stock filter, active filter, sorting, and low-stock-first ordering."
    dod_evidence:
      - "backend/app/services/balance.py created with get_product_balance."
      - "backend/app/services/__init__.py created."
    decisions:
      - "Balance is computed via SQL aggregation with IN/OUT case sums."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 12
      chapters_completed: 1
  - status_id: "status-0014"
    timestamp_tashkent: "2026-01-20T15:47:37+05:00"
    current_position:
      chapter_id: "CHAPTER 5"
      stage_id: "STAGE 5.2"
      stage_title: "Low Stock Count API"
    done:
      summary:
        - "Implemented stock overview API with balance and low-stock flag."
      details:
        - "Added GET /stock/overview with search, filters, sorting, and low-stock-first ordering."
        - "Overview response includes product fields, computed balance, and low_stock flag."
    next_actions_current_stage:
      - "Implement GET /stock/low/count endpoint."
      - "Return total number of low-stock products."
    dod_evidence:
      - "backend/app/api/stock.py created with /stock/overview."
      - "backend/app/schemas/stock.py created."
      - "backend/app/schemas/__init__.py updated with stock schemas."
      - "backend/app/main.py updated to include stock router."
    decisions:
      - "Low-stock flag respects low_stock_enabled and min_stock."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 13
      chapters_completed: 1
  - status_id: "status-0015"
    timestamp_tashkent: "2026-01-20T15:48:38+05:00"
    current_position:
      chapter_id: "CHAPTER 6"
      stage_id: "STAGE 6.1"
      stage_title: "Settings Model & API"
    done:
      summary:
        - "Implemented low stock count API."
      details:
        - "Added GET /stock/low/count to return total number of low-stock products."
    next_actions_current_stage:
      - "Create settings storage (single owner scope)."
      - "Implement GET /settings and PUT /settings for low-stock behavior."
    dod_evidence:
      - "backend/app/api/stock.py updated with /stock/low/count."
    decisions:
      - "Low-stock count considers only active products."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 14
      chapters_completed: 1
  - status_id: "status-0016"
    timestamp_tashkent: "2026-01-20T15:50:31+05:00"
    current_position:
      chapter_id: "CHAPTER 6"
      stage_id: "STAGE 6.2"
      stage_title: "Frontend Popup Logic"
    done:
      summary:
        - "Implemented settings storage and API."
      details:
        - "Added Settings model with low-stock popup, pin-to-top, and cooldown hours."
        - "Implemented GET /settings and PUT /settings endpoints."
    next_actions_current_stage:
      - "Show a single popup if low-stock count > 0."
      - "Respect cooldown to avoid repeated notifications."
      - "Provide popup actions: Show low-stock and Close."
    dod_evidence:
      - "backend/app/models/settings.py created."
      - "backend/app/api/settings.py created."
      - "backend/app/schemas/settings.py created."
      - "backend/app/schemas/__init__.py updated with settings schemas."
      - "backend/app/models/__init__.py updated with Settings."
      - "backend/app/main.py updated to include settings router."
    decisions:
      - "Settings stored as a single-row table, created on demand."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 15
      chapters_completed: 1
  - status_id: "status-0017"
    timestamp_tashkent: "2026-01-20T15:56:55+05:00"
    current_position:
      chapter_id: "CHAPTER 7"
      stage_id: "STAGE 7.1"
      stage_title: "Frontend Skeleton"
    done:
      summary:
        - "Reordered roadmap to place frontend work before popup logic."
      details:
        - "Moved STAGE 6.2 and 6.3 after frontend stages due to dependency on UI."
    next_actions_current_stage:
      - "Initialize React frontend project."
      - "Configure API client with credentials support."
      - "Setup routing and protected routes."
    dod_evidence:
      - "docs/roadmap.md updated with new stage ordering."
    decisions:
      - "Frontend skeleton is required before implementing popup logic."
    open_questions:
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 15
      chapters_completed: 1
  - status_id: "status-0018"
    timestamp_tashkent: "2026-01-20T16:01:51+05:00"
    current_position:
      chapter_id: "CHAPTER 7"
      stage_id: "STAGE 7.2"
      stage_title: "Login Page"
    done:
      summary:
        - "Initialized React frontend skeleton with routing and protected routes."
      details:
        - "Added API client with credentials support and auth context."
        - "Configured routes for login and inventory with protected access."
    next_actions_current_stage:
      - "Build login form UI."
      - "Connect to backend login endpoint."
      - "Handle login errors and success redirect."
    dod_evidence:
      - "frontend/ initialized with Vite React template."
      - "frontend/src/lib/api.js created with credentialed fetch helper."
      - "frontend/src/state/auth.jsx created with session refresh and login/logout."
      - "frontend/src/routes/ProtectedRoute.jsx created."
      - "frontend/src/pages/Login.jsx and frontend/src/pages/Inventory.jsx created."
      - "frontend/src/App.jsx and frontend/src/main.jsx updated for routing."
      - "frontend/.env.example added with VITE_API_BASE_URL."
    decisions:
      - "React chosen for frontend implementation."
    open_questions:
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 16
      chapters_completed: 1
  - status_id: "status-0019"
    timestamp_tashkent: "2026-01-20T16:23:05+05:00"
    current_position:
      chapter_id: "CHAPTER 7"
      stage_id: "STAGE 7.3"
      stage_title: "Inventory Page (Main Screen)"
    done:
      summary:
        - "Implemented login page and session flow."
      details:
        - "Login form posts to /auth/login and redirects on success."
        - "Auth context refreshes session via /auth/me."
        - "Added theme toggle with light/dark modes."
    next_actions_current_stage:
      - "Build inventory table UI."
      - "Add search input."
      - "Add low-stock filter toggle."
      - "Add sorting controls."
      - "Highlight low-stock rows."
      - "Add “IN / OUT” actions per product."
    dod_evidence:
      - "frontend/src/pages/Login.jsx created with form and login handler."
      - "frontend/src/state/auth.jsx created with login/logout and session refresh."
      - "frontend/src/lib/api.js created for backend auth requests."
      - "frontend/src/routes/ProtectedRoute.jsx created for auth gating."
      - "frontend/src/state/theme.jsx created with light/dark theme toggle."
      - "frontend/src/components/ThemeToggle.jsx created."
      - "frontend/src/index.css updated with theme variables and dark palette."
    decisions:
      - "Theme preference stored in localStorage and applied via body data-theme."
    open_questions:
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 17
      chapters_completed: 1
  - status_id: "status-0020"
    timestamp_tashkent: "2026-01-20T16:30:43+05:00"
    current_position:
      chapter_id: "CHAPTER 7"
      stage_id: "STAGE 7.4"
      stage_title: "Product Management UI"
    done:
      summary:
        - "Built the inventory table UI with filters and sorting."
        - "Highlighted low-stock products and added IN/OUT action buttons."
      details:
        - "Inventory page now fetches stock overview data with search, low-stock filter, and sort controls."
        - "Low-stock rows are visually highlighted with a badge."
        - "Action buttons render per product row with a placeholder notice."
    next_actions_current_stage:
      - "Add product create/edit modal or page."
      - "Validate product fields (name, min_stock)."
      - "Add delete/deactivate action."
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated with inventory table UI, filters, and actions."
      - "frontend/src/lib/api.js updated with stock overview API helper."
      - "frontend/src/index.css updated with inventory layout and table styles."
    decisions:
      - "Frontend API client uses fetch."
    open_questions: []
    metrics:
      stages_completed: 18
      chapters_completed: 1
  - status_id: "status-0021"
    timestamp_tashkent: "2026-01-20T16:42:44+05:00"
    current_position:
      chapter_id: "CHAPTER 7"
      stage_id: "STAGE 7.5"
      stage_title: "Movement UI"
    done:
      summary:
        - "Added product management UI with create/edit modal and deactivate action."
        - "Implemented frontend product API helpers."
      details:
        - "Inventory page now includes product list, search, and edit/deactivate controls."
        - "Modal form validates name, unit, and min stock before saving."
        - "Product changes refresh both product list and stock overview."
    next_actions_current_stage:
      - "Add movement create modal (IN/OUT)."
      - "Add movements history page/table."
      - "Add movement filters (optional)."
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated with product management UI and modal."
      - "frontend/src/lib/api.js updated with product CRUD helpers."
      - "frontend/src/index.css updated with product panel and modal styles."
    decisions:
      - "Product management lives on the inventory screen with a modal editor."
    open_questions: []
    metrics:
      stages_completed: 19
      chapters_completed: 1
  - status_id: "status-0022"
    timestamp_tashkent: "2026-01-20T16:53:23+05:00"
    current_position:
      chapter_id: "CHAPTER 7"
      stage_id: "STAGE 7.6"
      stage_title: "Settings UI"
    done:
      summary:
        - "Added movement creation modal for IN/OUT actions."
        - "Built movement history page with basic filters."
      details:
        - "Inventory screen opens movement modal from row actions or a new movement button."
        - "Movements page lists history with product/type filters and uses product lookup."
        - "Movement API helpers added for list/create."
    next_actions_current_stage:
      - "Add settings panel/page for low-stock behavior toggles."
      - "Save settings to backend."
    dod_evidence:
      - "frontend/src/components/MovementModal.jsx created."
      - "frontend/src/pages/Movements.jsx created."
      - "frontend/src/pages/Inventory.jsx updated with movement modal integration."
      - "frontend/src/lib/api.js updated with movement helpers."
      - "frontend/src/App.jsx updated with /movements route."
      - "frontend/src/index.css updated with link button styles."
    decisions:
      - "Movement history is presented on a dedicated page with basic filters."
    open_questions: []
    metrics:
      stages_completed: 20
      chapters_completed: 1
  - status_id: "status-0023"
    timestamp_tashkent: "2026-01-20T16:57:34+05:00"
    current_position:
      chapter_id: "CHAPTER 7"
      stage_id: "STAGE 7.6"
      stage_title: "Settings UI"
    done:
      summary:
        - "Fixed Pydantic ORM serialization for SQLAlchemy models."
      details:
        - "Updated schema config to support Pydantic v2 from_attributes with fallback for v1."
    next_actions_current_stage:
      - "Add settings panel/page for low-stock behavior toggles."
      - "Save settings to backend."
    dod_evidence:
      - "backend/app/schemas/product.py updated with from_attributes fallback."
      - "backend/app/schemas/movement.py updated with from_attributes fallback."
      - "backend/app/schemas/settings.py updated with from_attributes fallback."
    decisions:
      - "Schema models now support Pydantic v2+ while retaining v1 compatibility."
    open_questions: []
    metrics:
      stages_completed: 20
      chapters_completed: 1
  - status_id: "status-0024"
    timestamp_tashkent: "2026-01-20T17:06:12+05:00"
    current_position:
      chapter_id: "CHAPTER 7"
      stage_id: "STAGE 7.6"
      stage_title: "Settings UI"
    done:
      summary:
        - "Added hard delete for products alongside deactivate."
        - "Added initial stock field on product creation."
      details:
        - "Backend now accepts initial_stock and records an initial IN movement when provided."
        - "Product UI now offers Delete and Initial stock on create."
    next_actions_current_stage:
      - "Add settings panel/page for low-stock behavior toggles."
      - "Save settings to backend."
    dod_evidence:
      - "backend/app/api/products.py updated with hard delete and initial stock movement."
      - "backend/app/schemas/product.py updated with initial_stock."
      - "frontend/src/pages/Inventory.jsx updated with delete action and initial stock field."
      - "frontend/src/lib/api.js updated with hard delete helper."
    decisions:
      - "Hard delete removes product and its movements."
    open_questions: []
    metrics:
      stages_completed: 20
      chapters_completed: 1
  - status_id: "status-0025"
    timestamp_tashkent: "2026-01-20T17:11:19+05:00"
    current_position:
      chapter_id: "CHAPTER 7"
      stage_id: "STAGE 7.6"
      stage_title: "Settings UI"
    done:
      summary:
        - "Expanded inventory layout to full width."
        - "Added activate action for inactive products."
      details:
        - "Inventory page now stretches panels to full width."
        - "Product list shows Activate for inactive items and updates is_active."
    next_actions_current_stage:
      - "Add settings panel/page for low-stock behavior toggles."
      - "Save settings to backend."
    dod_evidence:
      - "frontend/src/index.css updated with full-width inventory layout."
      - "frontend/src/pages/Inventory.jsx updated with activate action."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 20
      chapters_completed: 1
  - status_id: "status-0026"
    timestamp_tashkent: "2026-01-20T17:16:54+05:00"
    current_position:
      chapter_id: "CHAPTER 7"
      stage_id: "STAGE 7.6"
      stage_title: "Settings UI"
    done:
      summary:
        - "Added client-side sorting and status filters for product management."
      details:
        - "Product list can be filtered by active/inactive and sorted by created date, name, or min stock."
    next_actions_current_stage:
      - "Add settings panel/page for low-stock behavior toggles."
      - "Save settings to backend."
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated with product filters and sorting controls."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 20
      chapters_completed: 1
  - status_id: "status-0027"
    timestamp_tashkent: "2026-01-20T17:21:17+05:00"
    current_position:
      chapter_id: "CHAPTER 6"
      stage_id: "STAGE 6.2"
      stage_title: "Frontend Popup Logic"
    done:
      summary:
        - "Added settings page for low-stock behavior."
      details:
        - "Settings page loads and updates low-stock popup, pin-to-top, and cooldown hours."
        - "Navigation links updated to include Settings."
    next_actions_current_stage:
      - "Show a single popup if low-stock count > 0."
      - "Respect cooldown to avoid repeated notifications."
      - "Provide popup actions: Show low-stock and Close."
    dod_evidence:
      - "frontend/src/pages/Settings.jsx created."
      - "frontend/src/lib/api.js updated with settings helpers."
      - "frontend/src/App.jsx updated with /settings route."
      - "frontend/src/pages/Inventory.jsx updated with Settings link."
      - "frontend/src/pages/Movements.jsx updated with Settings link."
    decisions:
      - "Settings UI implemented as a dedicated page."
    open_questions: []
    metrics:
      stages_completed: 21
      chapters_completed: 1
  - status_id: "status-0028"
    timestamp_tashkent: "2026-01-20T17:23:23+05:00"
    current_position:
      chapter_id: "CHAPTER 6"
      stage_id: "STAGE 6.2"
      stage_title: "Frontend Popup Logic"
    done:
      summary:
        - "Reordered unit column to be third in inventory-related tables."
      details:
        - "Stock overview and product management tables now show Unit as the third column."
        - "Movements table now includes Unit as the third column."
    next_actions_current_stage:
      - "Show a single popup if low-stock count > 0."
      - "Respect cooldown to avoid repeated notifications."
      - "Provide popup actions: Show low-stock and Close."
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated with column order changes."
      - "frontend/src/pages/Movements.jsx updated with unit column."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 21
      chapters_completed: 1
  - status_id: "status-0029"
    timestamp_tashkent: "2026-01-20T17:25:47+05:00"
    current_position:
      chapter_id: "CHAPTER 6"
      stage_id: "STAGE 6.2"
      stage_title: "Frontend Popup Logic"
    done:
      summary:
        - "Standardized table column spacing with fixed layouts."
      details:
        - "Added colgroup widths for inventory, product management, and movements tables."
        - "Applied fixed table layout with ellipsis for long content."
    next_actions_current_stage:
      - "Show a single popup if low-stock count > 0."
      - "Respect cooldown to avoid repeated notifications."
      - "Provide popup actions: Show low-stock and Close."
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated with colgroup widths."
      - "frontend/src/pages/Movements.jsx updated with colgroup widths."
      - "frontend/src/index.css updated with fixed table layout."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 21
      chapters_completed: 1
  - status_id: "status-0030"
    timestamp_tashkent: "2026-01-20T17:27:44+05:00"
    current_position:
      chapter_id: "CHAPTER 6"
      stage_id: "STAGE 6.2"
      stage_title: "Frontend Popup Logic"
    done:
      summary:
        - "Allowed full product names to wrap in table columns."
      details:
        - "First column in inventory tables now wraps instead of truncating."
    next_actions_current_stage:
      - "Show a single popup if low-stock count > 0."
      - "Respect cooldown to avoid repeated notifications."
      - "Provide popup actions: Show low-stock and Close."
    dod_evidence:
      - "frontend/src/index.css updated to allow wrapping in the first column."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 21
      chapters_completed: 1
  - status_id: "status-0031"
    timestamp_tashkent: "2026-01-20T17:37:05+05:00"
    current_position:
      chapter_id: "CHAPTER 6"
      stage_id: "STAGE 6.2"
      stage_title: "Frontend Popup Logic"
    done:
      summary:
        - "Added low-stock popup logic to the inventory page."
      details:
        - "Popup respects settings, low-stock count, and cooldown stored in localStorage."
        - "Popup actions allow showing low-stock filter or dismissing."
    next_actions_current_stage:
      - "Show a single popup if low-stock count > 0."
      - "Respect cooldown to avoid repeated notifications."
      - "Provide popup actions: Show low-stock and Close."
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated with popup logic and UI."
      - "frontend/src/lib/api.js updated with low stock count helper."
    decisions:
      - "Cooldown tracking stored in localStorage."
    open_questions: []
    metrics:
      stages_completed: 21
      chapters_completed: 1
  - status_id: "status-0032"
    timestamp_tashkent: "2026-01-20T17:37:59+05:00"
    current_position:
      chapter_id: "CHAPTER 6"
      stage_id: "STAGE 6.3"
      stage_title: "Low-Stock Pin-to-Top Behavior"
    done:
      summary:
        - "User confirmed popup logic and approved moving to the next stage."
      details:
        - "Proceeding to implement low-stock pin-to-top behavior."
    next_actions_current_stage:
      - "If enabled, apply low-first sorting on the inventory page."
      - "If disabled, use normal sorting only."
    dod_evidence:
      - "User confirmation to proceed from STAGE 6.2."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 22
      chapters_completed: 1
  - status_id: "status-0033"
    timestamp_tashkent: "2026-01-20T17:43:13+05:00"
    current_position:
      chapter_id: "CHAPTER 6"
      stage_id: "STAGE 6.2"
      stage_title: "Frontend Popup Logic"
    done:
      summary:
        - "Adjusted low-stock popup logic for relogin and new low-stock events."
      details:
        - "Popup now re-evaluates on inventory changes and shows when low-stock count increases."
        - "Cooldown is tracked per session and reset on relogin."
    next_actions_current_stage:
      - "Show a single popup if low-stock count > 0."
      - "Respect cooldown to avoid repeated notifications."
      - "Provide popup actions: Show low-stock and Close."
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated with session-aware popup logic."
    decisions:
      - "Cooldown is stored in sessionStorage and reset when the user session changes."
      - "Popup displays immediately when low-stock count increases."
    open_questions: []
    metrics:
      stages_completed: 22
      chapters_completed: 1
  - status_id: "status-0034"
    timestamp_tashkent: "2026-01-20T17:47:21+05:00"
    current_position:
      chapter_id: "CHAPTER 6"
      stage_id: "STAGE 6.2"
      stage_title: "Frontend Popup Logic"
    done:
      summary:
        - "Prevented low-stock popup from reappearing on every reload."
      details:
        - "Popup cooldown now persists per user within a session, while still resetting on user change."
        - "Low-stock count tracking survives reload to avoid false 'increase' triggers."
    next_actions_current_stage:
      - "Show a single popup if low-stock count > 0."
      - "Respect cooldown to avoid repeated notifications."
      - "Provide popup actions: Show low-stock and Close."
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated with session-aware popup storage."
    decisions:
      - "Popup state stores last seen and last count per user in sessionStorage."
    open_questions: []
    metrics:
      stages_completed: 22
      chapters_completed: 1
  - status_id: "status-0035"
    timestamp_tashkent: "2026-01-20T17:49:57+05:00"
    current_position:
      chapter_id: "CHAPTER 6"
      stage_id: "STAGE 6.2"
      stage_title: "Frontend Popup Logic"
    done:
      summary:
        - "Separated popup Close and Dismiss behaviors."
      details:
        - "Close now hides the popup without updating cooldown."
        - "Dismiss respects cooldown by recording last seen."
    next_actions_current_stage:
      - "Show a single popup if low-stock count > 0."
      - "Respect cooldown to avoid repeated notifications."
      - "Provide popup actions: Show low-stock and Close."
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated with distinct Close/Dismiss behavior."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 22
      chapters_completed: 1
  - status_id: "status-0036"
    timestamp_tashkent: "2026-01-20T17:56:09+05:00"
    current_position:
      chapter_id: "CHAPTER 6"
      stage_id: "STAGE 6.3"
      stage_title: "Low-Stock Pin-to-Top Behavior"
    done:
      summary:
        - "User confirmed popup behavior and requested next stage."
      details:
        - "Proceeding to implement low-stock pin-to-top behavior."
    next_actions_current_stage:
      - "If enabled, apply low-first sorting on the inventory page."
      - "If disabled, use normal sorting only."
    dod_evidence:
      - "User confirmation to proceed from STAGE 6.2."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 23
      chapters_completed: 1
  - status_id: "status-0037"
    timestamp_tashkent: "2026-01-20T17:59:20+05:00"
    current_position:
      chapter_id: "CHAPTER 6"
      stage_id: "STAGE 6.3"
      stage_title: "Low-Stock Pin-to-Top Behavior"
    done:
      summary:
        - "Hooked low-stock pin-to-top setting into stock overview requests."
      details:
        - "Inventory now requests low_stock_first when pin-to-top is enabled."
    next_actions_current_stage:
      - "If enabled, apply low-first sorting on the inventory page."
      - "If disabled, use normal sorting only."
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated to pass low_stock_first."
      - "frontend/src/lib/api.js updated with low_stock_first parameter."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 23
      chapters_completed: 1
  - status_id: "status-0038"
    timestamp_tashkent: "2026-01-21T12:56:19+05:00"
    current_position:
      chapter_id: "CHAPTER 8"
      stage_id: "STAGE 8.1"
      stage_title: "Export API"
    done:
      summary:
        - "Applied low-stock pin-to-top behavior in inventory requests."
      details:
        - "Inventory overview requests now pass low_stock_first when pin-to-top is enabled."
        - "Standard sorting remains in place when the pin-to-top setting is disabled."
    next_actions_current_stage:
      - "Implement GET /export/products.csv."
      - "Implement GET /export/movements.csv (optional date filtering)."
      - "Ensure UTF-8 encoding and spreadsheet compatibility."
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated to conditionally pass low_stock_first."
      - "frontend/src/lib/api.js updated with low_stock_first query parameter support."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 24
      chapters_completed: 1
  - status_id: "status-0039"
    timestamp_tashkent: "2026-01-21T12:59:47+05:00"
    current_position:
      chapter_id: "CHAPTER 8"
      stage_id: "STAGE 8.2"
      stage_title: "Export UI"
    done:
      summary:
        - "Implemented CSV export API for products and movements."
      details:
        - "Added /export/products.csv with product fields plus computed balance."
        - "Added /export/movements.csv with optional start_at/end_at filtering."
        - "CSV responses include UTF-8 BOM for spreadsheet compatibility."
    next_actions_current_stage:
      - "Add export buttons to the inventory page."
      - "Trigger CSV download from frontend."
    dod_evidence:
      - "backend/app/api/export.py created with CSV export endpoints."
      - "backend/app/main.py updated to include export router."
    decisions:
      - "CSV responses use UTF-8 with BOM for spreadsheet-friendly downloads."
      - "Movement export supports start_at/end_at ISO datetime filters."
    open_questions: []
    metrics:
      stages_completed: 25
      chapters_completed: 1
  - status_id: "status-0040"
    timestamp_tashkent: "2026-01-21T13:03:05+05:00"
    current_position:
      chapter_id: "CHAPTER 8"
      stage_id: "STAGE 8.1"
      stage_title: "Export API"
    done:
      summary:
        - "Implemented CSV export API for products and movements."
      details:
        - "Added /export/products.csv with product fields plus computed balance."
        - "Added /export/movements.csv with optional start_at/end_at filtering."
        - "CSV responses include UTF-8 BOM for spreadsheet compatibility."
    next_actions_current_stage:
      - "Consider adding export for stock overview (if approved)."
      - "Implement GET /export/stock_overview.csv if needed."
      - "Ensure UTF-8 encoding and spreadsheet compatibility."
    dod_evidence:
      - "backend/app/api/export.py created with CSV export endpoints."
      - "backend/app/main.py updated to include export router."
    decisions:
      - "Current stage remains STAGE 8.1 until user confirms moving on."
    open_questions: []
    metrics:
      stages_completed: 24
      chapters_completed: 1
  - status_id: "status-0041"
    timestamp_tashkent: "2026-01-21T13:04:14+05:00"
    current_position:
      chapter_id: "CHAPTER 8"
      stage_id: "STAGE 8.1"
      stage_title: "Export API"
    done:
      summary:
        - "Implemented CSV export API for products, movements, and stock overview."
      details:
        - "Added /export/products.csv with product fields plus computed balance."
        - "Added /export/movements.csv with optional start_at/end_at filtering."
        - "Added /export/stock_overview.csv with the same filters as /stock/overview."
        - "CSV responses include UTF-8 BOM for spreadsheet compatibility."
    next_actions_current_stage:
      - "Request confirmation to proceed to STAGE 8.2 (Export UI)."
    dod_evidence:
      - "backend/app/api/export.py updated with stock overview CSV export."
      - "backend/app/api/export.py contains products and movements CSV exports."
      - "backend/app/main.py includes export router."
    decisions:
      - "Stock overview export reuses the same filter and sort rules as /stock/overview."
    open_questions: []
    metrics:
      stages_completed: 25
      chapters_completed: 1
  - status_id: "status-0042"
    timestamp_tashkent: "2026-01-21T13:06:47+05:00"
    current_position:
      chapter_id: "CHAPTER 9"
      stage_id: "STAGE 9.1"
      stage_title: "Backend Validation Rules"
    done:
      summary:
        - "Added export buttons and CSV download flow on the inventory page."
      details:
        - "Inventory page now triggers CSV downloads for stock overview, products, and movements."
        - "Frontend CSV downloads use authenticated fetch and blob download to include cookies."
    next_actions_current_stage:
      - "Enforce quantity > 0 for movements."
      - "Enforce min_stock >= 0 for products."
      - "Prevent invalid movement types."
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated with export buttons and handlers."
      - "frontend/src/lib/api.js updated with CSV download helpers."
    decisions:
      - "CSV downloads use fetch + blob to preserve HttpOnly cookie authentication."
    open_questions: []
    metrics:
      stages_completed: 26
      chapters_completed: 1
  - status_id: "status-0043"
    timestamp_tashkent: "2026-01-21T13:09:33+05:00"
    current_position:
      chapter_id: "CHAPTER 8"
      stage_id: "STAGE 8.2"
      stage_title: "Export UI"
    done:
      summary:
        - "Moved export buttons to their relevant pages and sections."
      details:
        - "Stock overview export remains in the inventory stock overview controls."
        - "Products export moved to the product management controls."
        - "Movements export moved to the movements page controls."
    next_actions_current_stage:
      - "Request confirmation to proceed to STAGE 9.1 (Backend Validation Rules)."
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated to keep only stock overview export in stock controls."
      - "frontend/src/pages/Inventory.jsx updated with products export in product management controls."
      - "frontend/src/pages/Movements.jsx updated with movements export button and handler."
    decisions:
      - "Export actions are placed on the page that owns the data context."
    open_questions: []
    metrics:
      stages_completed: 26
      chapters_completed: 1
  - status_id: "status-0044"
    timestamp_tashkent: "2026-01-21T13:15:15+05:00"
    current_position:
      chapter_id: "CHAPTER 9"
      stage_id: "STAGE 9.1"
      stage_title: "Backend Validation Rules"
    done:
      summary:
        - "User confirmed completion of STAGE 8.2 (Export UI)."
      details:
        - "Proceeding to backend validation rules per roadmap."
    next_actions_current_stage:
      - "Enforce quantity > 0 for movements."
      - "Enforce min_stock >= 0 for products."
      - "Prevent invalid movement types."
    dod_evidence:
      - "User confirmation to proceed from STAGE 8.2."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 26
      chapters_completed: 1
  - status_id: "status-0045"
    timestamp_tashkent: "2026-01-21T13:16:24+05:00"
    current_position:
      chapter_id: "CHAPTER 9"
      stage_id: "STAGE 9.2"
      stage_title: "Core Automated Tests"
    done:
      summary:
        - "Added backend validation rules for movements and products."
      details:
        - "Movement schema enforces quantity > 0 and movement type IN/OUT."
        - "Product schema enforces min_stock >= 0 and initial_stock >= 0."
    next_actions_current_stage:
      - "Test authentication flow (login + protected endpoints)."
      - "Test balance calculation correctness."
      - "Test low-stock detection logic."
      - "Test stock overview search/filter behavior."
    dod_evidence:
      - "backend/app/schemas/movement.py updated with validators."
      - "backend/app/schemas/product.py updated with validators."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 27
      chapters_completed: 1
  - status_id: "status-0046"
    timestamp_tashkent: "2026-01-21T13:20:42+05:00"
    current_position:
      chapter_id: "CHAPTER 9"
      stage_id: "STAGE 9.3"
      stage_title: "UX Polishing"
    done:
      summary:
        - "Added core automated tests for authentication, balance, low-stock, and search."
      details:
        - "Test coverage includes login flow, protected access, balance calculation, low-stock detection, and search behavior."
        - "Test database uses SQLite in-memory with dependency override."
    next_actions_current_stage:
      - "Add loading states and error messages."
      - "Confirm inventory updates after movements."
      - "Ensure low-stock popup behavior is correct and non-spammy."
    dod_evidence:
      - "backend/tests/conftest.py created for test DB and auth client."
      - "backend/tests/test_auth.py added for auth flow tests."
      - "backend/tests/test_balance.py added for balance calculation test."
      - "backend/tests/test_stock_overview.py added for low-stock and search tests."
      - "backend/requirements.txt updated with pytest."
    decisions:
      - "Tests run against an in-memory SQLite database using FastAPI dependency overrides."
    open_questions: []
    metrics:
      stages_completed: 28
      chapters_completed: 1
  - status_id: "status-0047"
    timestamp_tashkent: "2026-01-21T13:24:46+05:00"
    current_position:
      chapter_id: "CHAPTER 9"
      stage_id: "STAGE 9.3"
      stage_title: "UX Polishing"
    done:
      summary:
        - "Added missing test dependency for FastAPI test client."
      details:
        - "Added httpx to backend requirements to satisfy starlette.testclient."
    next_actions_current_stage:
      - "Add loading states and error messages."
      - "Confirm inventory updates after movements."
      - "Ensure low-stock popup behavior is correct and non-spammy."
    dod_evidence:
      - "backend/requirements.txt updated with httpx."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 28
      chapters_completed: 1
  - status_id: "status-0048"
    timestamp_tashkent: "2026-01-21T13:25:54+05:00"
    current_position:
      chapter_id: "CHAPTER 9"
      stage_id: "STAGE 9.3"
      stage_title: "UX Polishing"
    done:
      summary:
        - "Fixed test import path to run pytest from backend/."
      details:
        - "Added backend root to sys.path in conftest to resolve app imports."
    next_actions_current_stage:
      - "Add loading states and error messages."
      - "Confirm inventory updates after movements."
      - "Ensure low-stock popup behavior is correct and non-spammy."
    dod_evidence:
      - "backend/tests/conftest.py updated with sys.path setup."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 28
      chapters_completed: 1
  - status_id: "status-0049"
    timestamp_tashkent: "2026-01-21T13:43:13+05:00"
    current_position:
      chapter_id: "CHAPTER 9"
      stage_id: "STAGE 9.3"
      stage_title: "UX Polishing"
    done:
      summary:
        - "Adjusted backend tests to run without ASGI test client hangs."
        - "All backend tests pass in the current environment."
      details:
        - "Tests now call API functions directly with DB sessions and fixtures."
        - "Auth tests validate login response, cookie set, and get_current_user behavior."
    next_actions_current_stage:
      - "Add loading states and error messages."
      - "Confirm inventory updates after movements."
      - "Ensure low-stock popup behavior is correct and non-spammy."
    dod_evidence:
      - "backend/tests/conftest.py updated to use direct DB fixtures."
      - "backend/tests/test_auth.py updated for direct auth dependency checks."
      - "backend/tests/test_balance.py updated for direct balance checks."
      - "backend/tests/test_stock_overview.py updated for direct stock overview checks."
      - "Manual check: `cd backend && .venv/bin/pytest` => 5 passed in 0.61s."
    decisions:
      - "Use direct function calls in tests due to ASGI test client hang on Python 3.14."
    open_questions: []
    metrics:
      stages_completed: 28
      chapters_completed: 1
  - status_id: "status-0050"
    timestamp_tashkent: "2026-01-21T13:51:05+05:00"
    current_position:
      chapter_id: "CHAPTER 9"
      stage_id: "STAGE 9.3"
      stage_title: "UX Polishing"
    done:
      summary:
        - "Added explicit loading states and guarded low-stock popup behavior."
      details:
        - "Inventory and product tables show loading rows while fetching."
        - "Movements table shows loading row and correct empty-state colspan."
        - "Low-stock popup now closes when alerts are disabled or count drops to zero."
    next_actions_current_stage:
      - "Request confirmation to proceed to STAGE 10.1 (Local Development Workflow)."
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated with loading rows and popup guard."
      - "frontend/src/pages/Movements.jsx updated with loading row and empty-state colspan."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 29
      chapters_completed: 1
  - status_id: "status-0051"
    timestamp_tashkent: "2026-01-21T13:56:32+05:00"
    current_position:
      chapter_id: "CHAPTER 9"
      stage_id: "STAGE 9.3"
      stage_title: "UX Polishing"
    done:
      summary:
        - "Adjusted low-stock popup to reappear on re-login without reload spam."
      details:
        - "Popup cooldown resets on explicit login events while remaining stable across reloads."
    next_actions_current_stage:
      - "Request confirmation to proceed to STAGE 10.1 (Local Development Workflow)."
    dod_evidence:
      - "frontend/src/state/auth.jsx updated with login nonce tracking."
      - "frontend/src/pages/Inventory.jsx updated to reset popup cooldown on login."
    decisions:
      - "Popup cooldown reset is tied to explicit login events, not page reloads."
    open_questions: []
    metrics:
      stages_completed: 29
      chapters_completed: 1
  - status_id: "status-0052"
    timestamp_tashkent: "2026-01-21T13:57:56+05:00"
    current_position:
      chapter_id: "CHAPTER 10"
      stage_id: "STAGE 10.1"
      stage_title: "Local Development Workflow"
    done:
      summary:
        - "User confirmed completion of STAGE 9.3 (UX Polishing)."
      details:
        - "Proceeding to document local development workflow."
    next_actions_current_stage:
      - "Document backend run commands."
      - "Document frontend run commands."
      - "Add environment setup steps."
    dod_evidence:
      - "User confirmation to proceed from STAGE 9.3."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 29
      chapters_completed: 1
  - status_id: "status-0053"
    timestamp_tashkent: "2026-01-21T13:59:01+05:00"
    current_position:
      chapter_id: "CHAPTER 10"
      stage_id: "STAGE 10.2"
      stage_title: "Production Build Notes"
    done:
      summary:
        - "Documented local development workflow for backend and frontend."
      details:
        - "Added backend virtualenv setup, environment config, and uvicorn run command."
        - "Added frontend dependency install, env setup, and dev server command."
    next_actions_current_stage:
      - "Document frontend build output usage."
      - "Confirm CORS/cookie settings for deployment."
    dod_evidence:
      - "README.md updated with Local Development Workflow section."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 30
      chapters_completed: 1
  - status_id: "status-0054"
    timestamp_tashkent: "2026-01-21T14:04:23+05:00"
    current_position:
      chapter_id: "CHAPTER 10"
      stage_id: "STAGE 10.2"
      stage_title: "Production Build Notes"
    done:
      summary:
        - "Documented frontend production build and deployment notes."
      details:
        - "Added build output location and backend URL configuration notes."
        - "Documented CORS and cookie considerations for deployment."
    next_actions_current_stage:
      - "Request confirmation to finalize STAGE 10.2."
    dod_evidence:
      - "README.md updated with Production Build Notes section."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 31
      chapters_completed: 2
  - status_id: "status-0055"
    timestamp_tashkent: "2026-01-21T14:06:34+05:00"
    current_position:
      chapter_id: "CHAPTER 10"
      stage_id: "STAGE 10.2"
      stage_title: "Production Build Notes"
    done:
      summary:
        - "User confirmed completion of STAGE 10.2."
      details:
        - "Project roadmap stages are complete."
    next_actions_current_stage: []
    dod_evidence:
      - "User confirmation to finalize STAGE 10.2."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 31
      chapters_completed: 2
  - status_id: "status-0056"
    timestamp_tashkent: "2026-01-21T14:18:02+05:00"
    current_position:
      chapter_id: "CHAPTER 10"
      stage_id: "STAGE 10.2"
      stage_title: "Production Build Notes"
    done:
      summary:
        - "Added root .env with admin credentials and explicit database path."
      details:
        - "Configured DATABASE_URL to point to backend/app.db for consistent login."
        - "Set admin login to use username 'admin' with a simple password."
    next_actions_current_stage:
      - "Restart backend to load the new .env settings."
      - "Log in with admin/simplepass."
    dod_evidence:
      - ".env created in project root with updated credentials and DB URL."
    decisions:
      - "Use absolute SQLite path to avoid differing working directories."
    open_questions: []
    metrics:
      stages_completed: 31
      chapters_completed: 2
  - status_id: "status-0057"
    timestamp_tashkent: "2026-01-21T14:20:27+05:00"
    current_position:
      chapter_id: "CHAPTER 10"
      stage_id: "STAGE 10.2"
      stage_title: "Production Build Notes"
    done:
      summary:
        - "Updated login form to accept non-email admin usernames."
      details:
        - "Login field now uses a text input with admin placeholder and trims whitespace."
    next_actions_current_stage: []
    dod_evidence:
      - "frontend/src/pages/Login.jsx updated to use text input for username."
    decisions:
      - "Keep backend login payload key as email while allowing non-email values."
    open_questions: []
    metrics:
      stages_completed: 31
      chapters_completed: 2
  - status_id: "status-0058"
    timestamp_tashkent: "2026-01-21T14:25:58+05:00"
    current_position:
      chapter_id: "CHAPTER 10"
      stage_id: "STAGE 10.2"
      stage_title: "Production Build Notes"
    done:
      summary:
        - "Aligned frontend API base URL to avoid auth cookie mismatch."
      details:
        - "Created frontend/.env with VITE_API_BASE_URL=http://127.0.0.1:8000."
    next_actions_current_stage:
      - "Restart frontend dev server to pick up the new environment value."
    dod_evidence:
      - "frontend/.env created with updated API base URL."
    decisions:
      - "Use 127.0.0.1 for both frontend API requests and backend host to keep cookies valid."
    open_questions: []
    metrics:
      stages_completed: 31
      chapters_completed: 2
  - status_id: "status-0059"
    timestamp_tashkent: "2026-01-21T14:30:00+05:00"
    current_position:
      chapter_id: "CHAPTER 10"
      stage_id: "STAGE 10.2"
      stage_title: "Production Build Notes"
    done:
      summary:
        - "Aligned frontend and backend hostnames to fix auth cookie usage."
      details:
        - "Set frontend API base URL to http://localhost:8000."
        - "Set FRONTEND_ORIGIN to http://localhost:5173."
    next_actions_current_stage:
      - "Restart backend and frontend to load new env values."
    dod_evidence:
      - ".env updated with localhost origin."
      - "frontend/.env updated with localhost API base URL."
    decisions:
      - "Use localhost for both frontend and backend to keep cookies consistent."
    open_questions: []
    metrics:
      stages_completed: 31
      chapters_completed: 2
  - status_id: "status-0060"
    timestamp_tashkent: "2026-01-21T14:33:18+05:00"
    current_position:
      chapter_id: "CHAPTER 10"
      stage_id: "STAGE 10.2"
      stage_title: "Production Build Notes"
    done:
      summary:
        - "Prevented low-stock popup from reappearing when navigating back to inventory."
      details:
        - "Popup Close now suppresses repeats until low-stock count increases."
        - "Dismiss still respects cooldown and clears the suppression state."
    next_actions_current_stage: []
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated with closedCount suppression."
    decisions:
      - "Treat Close as a temporary hide until low-stock count grows."
    open_questions: []
    metrics:
      stages_completed: 31
      chapters_completed: 2
  - status_id: "status-0061"
    timestamp_tashkent: "2026-01-21T15:11:10+05:00"
    current_position:
      chapter_id: "CHAPTER 10"
      stage_id: "STAGE 10.2"
      stage_title: "Production Build Notes"
    done:
      summary:
        - "Removed username placeholder from login form."
      details:
        - "Login username field now stays empty without example text."
    next_actions_current_stage: []
    dod_evidence:
      - "frontend/src/pages/Login.jsx updated to remove placeholder."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 31
      chapters_completed: 2
  - status_id: "status-0062"
    timestamp_tashkent: "2026-01-21T15:16:14+05:00"
    current_position:
      chapter_id: "CHAPTER 10"
      stage_id: "STAGE 10.2"
      stage_title: "Production Build Notes"
    done:
      summary:
        - "Stopped low-stock popup from reappearing on navigation without count changes."
        - "Updated login copy to production-style messaging."
      details:
        - "Popup now tracks last shown count across page navigation and only reopens on count increase."
        - "Login screen no longer references .env for credentials."
    next_actions_current_stage: []
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated with lastShownCount handling."
      - "frontend/src/pages/Login.jsx updated with production-ready copy."
    decisions:
      - "Use last shown count as the suppression key for popup re-display."
    open_questions: []
    metrics:
      stages_completed: 31
      chapters_completed: 2
  - status_id: "status-0063"
    timestamp_tashkent: "2026-01-21T15:21:54+05:00"
    current_position:
      chapter_id: "CHAPTER 10"
      stage_id: "STAGE 10.2"
      stage_title: "Production Build Notes"
    done:
      summary:
        - "Stopped low-stock popup from resetting on relogin."
      details:
        - "Popup suppression state now persists across login events and page navigation."
    next_actions_current_stage: []
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated to avoid clearing popup state on login."
    decisions:
      - "Only reset popup state when the user identity changes."
    open_questions: []
    metrics:
      stages_completed: 31
      chapters_completed: 2
  - status_id: "status-0064"
    timestamp_tashkent: "2026-01-21T15:24:37+05:00"
    current_position:
      chapter_id: "CHAPTER 10"
      stage_id: "STAGE 10.2"
      stage_title: "Production Build Notes"
    done:
      summary:
        - "Reset low-stock popup suppression when the setting is turned off."
      details:
        - "Disabling the popup clears last shown count so it shows once after re-enable."
    next_actions_current_stage: []
    dod_evidence:
      - "frontend/src/pages/Inventory.jsx updated with popup enable/disable tracking."
    decisions:
      - "Popup state resets only when the setting transitions from on to off."
    open_questions: []
    metrics:
      stages_completed: 31
      chapters_completed: 2
  - status_id: "status-0065"
    timestamp_tashkent: "2026-01-21T15:47:08+05:00"
    current_position:
      chapter_id: "CHAPTER 11"
      stage_id: "STAGE 11.2"
      stage_title: "Production Database (Postgres via DATABASE_URL)"
    done:
      summary:
        - "Prepared FastAPI to serve React build and moved API under /api."
      details:
        - "Mounted static frontend at / with SPA fallback."
        - "Moved backend routers and ping endpoint under /api."
        - "Frontend API client now targets /api paths."
    next_actions_current_stage:
      - "Add Postgres driver dependency for SQLAlchemy."
      - "Ensure DATABASE_URL is used for production."
    dod_evidence:
      - "backend/app/main.py updated with /api prefix and StaticFiles mount."
      - "backend/app/static/.gitkeep added for static root."
      - "frontend/src/lib/api.js updated to prefix /api."
    decisions:
      - "API surface is now under /api to support SPA routing at root."
    open_questions: []
    metrics:
      stages_completed: 32
      chapters_completed: 2
  - status_id: "status-0066"
    timestamp_tashkent: "2026-01-21T15:50:59+05:00"
    current_position:
      chapter_id: "CHAPTER 11"
      stage_id: "STAGE 11.3"
      stage_title: "Render Docker Deployment (Single Service)"
    done:
      summary:
        - "Prepared production Postgres configuration via DATABASE_URL."
      details:
        - "Added psycopg driver dependency for SQLAlchemy."
        - "Updated DATABASE_URL example to Postgres format."
    next_actions_current_stage:
      - "Create a multi-stage Dockerfile for frontend build + backend serve."
      - "Configure Render Web Service to use the Dockerfile."
      - "Ensure the service serves SPA and /api routes."
    dod_evidence:
      - "backend/requirements.txt updated with psycopg."
      - ".env.example updated with Postgres DATABASE_URL example."
    decisions:
      - "Use psycopg driver for PostgreSQL connections."
    open_questions: []
    metrics:
      stages_completed: 33
      chapters_completed: 2
  - status_id: "status-0067"
    timestamp_tashkent: "2026-01-21T15:52:40+05:00"
    current_position:
      chapter_id: "CHAPTER 11"
      stage_id: "STAGE 11.3"
      stage_title: "Render Docker Deployment (Single Service)"
    done:
      summary:
        - "Updated local env to Postgres DATABASE_URL for consistency."
      details:
        - "DATABASE_URL now uses postgresql+psycopg scheme."
    next_actions_current_stage:
      - "Create a multi-stage Dockerfile for frontend build + backend serve."
      - "Configure Render Web Service to use the Dockerfile."
      - "Ensure the service serves SPA and /api routes."
    dod_evidence:
      - ".env updated with Postgres DATABASE_URL."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 33
      chapters_completed: 2
  - status_id: "status-0068"
    timestamp_tashkent: "2026-01-21T15:54:03+05:00"
    current_position:
      chapter_id: "CHAPTER 11"
      stage_id: "STAGE 11.4"
      stage_title: "Migrations + Owner Seed Strategy"
    done:
      summary:
        - "Added single-container Docker build for Render deployment."
      details:
        - "Multi-stage Dockerfile builds React and serves static files from FastAPI."
        - "Backend image installs Python deps and copies frontend dist into static root."
    next_actions_current_stage:
      - "Define how migrations are run on deploy."
      - "Define initial owner/admin user creation strategy."
      - "Document startup steps and env vars for Render."
    dod_evidence:
      - "Dockerfile created with multi-stage build."
      - ".dockerignore added for build context hygiene."
    decisions:
      - "Use a single Docker image to serve API and SPA."
    open_questions: []
    metrics:
      stages_completed: 34
      chapters_completed: 2
  - status_id: "status-0069"
    timestamp_tashkent: "2026-01-21T15:56:38+05:00"
    current_position:
      chapter_id: "CHAPTER 11"
      stage_id: "STAGE 11.4"
      stage_title: "Migrations + Owner Seed Strategy"
    done:
      summary:
        - "Defined migration and admin seeding strategy for deployment."
      details:
        - "Container entrypoint runs Alembic migrations and ensures the admin user exists."
        - "Render deployment expectations documented in README."
    next_actions_current_stage: []
    dod_evidence:
      - "backend/app/scripts/init_db.py added for migrations and seeding."
      - "backend/entrypoint.sh added to run init and start uvicorn."
      - "Dockerfile updated to use entrypoint.sh."
      - "README.md updated with Render deployment notes."
    decisions:
      - "Run migrations and admin seeding on container start."
    open_questions: []
    metrics:
      stages_completed: 35
      chapters_completed: 2
  - status_id: "status-0070"
    timestamp_tashkent: "2026-01-21T16:01:42+05:00"
    current_position:
      chapter_id: "CHAPTER 11"
      stage_id: "STAGE 11.4"
      stage_title: "Migrations + Owner Seed Strategy"
    done:
      summary:
        - "Documented initial admin credentials source."
      details:
        - "README now notes ADMIN_EMAIL and ADMIN_PASSWORD create the first admin."
    next_actions_current_stage: []
    dod_evidence:
      - "README.md updated with admin credential note."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 35
      chapters_completed: 2
  - status_id: "status-0071"
    timestamp_tashkent: "2026-01-21T16:50:20+05:00"
    current_position:
      chapter_id: "CHAPTER 11"
      stage_id: "STAGE 11.4"
      stage_title: "Migrations + Owner Seed Strategy"
    done:
      summary:
        - "Added psycopg2 driver to match Render DATABASE_URL defaults."
      details:
        - "SQLAlchemy can now import psycopg2 when Render provides a postgres:// URL."
    next_actions_current_stage: []
    dod_evidence:
      - "backend/requirements.txt updated with psycopg2-binary."
    decisions:
      - "Include psycopg2-binary for compatibility with default Postgres URLs."
    open_questions: []
    metrics:
      stages_completed: 35
      chapters_completed: 2
  - status_id: "status-0072"
    timestamp_tashkent: "2026-01-21T17:10:20+05:00"
    current_position:
      chapter_id: "CHAPTER 11"
      stage_id: "STAGE 11.4"
      stage_title: "Migrations + Owner Seed Strategy"
    done:
      summary:
        - "Added table bootstrap fallback when migrations are missing."
      details:
        - "Init script now creates tables if the users table is absent before seeding."
    next_actions_current_stage: []
    dod_evidence:
      - "backend/app/scripts/init_db.py updated to call Base.metadata.create_all when needed."
    decisions:
      - "Fallback to create_all only when migrations did not create tables."
    open_questions: []
    metrics:
      stages_completed: 35
      chapters_completed: 2
  - status_id: "status-0073"
    timestamp_tashkent: "2026-01-21T17:15:56+05:00"
    current_position:
      chapter_id: "CHAPTER 11"
      stage_id: "STAGE 11.4"
      stage_title: "Migrations + Owner Seed Strategy"
    done:
      summary:
        - "Adjusted frontend API base to use same-origin in production."
      details:
        - "API requests default to window.location.origin when VITE_API_BASE_URL is unset."
    next_actions_current_stage: []
    dod_evidence:
      - "frontend/src/lib/api.js updated to use window.location.origin."
    decisions:
      - "Production uses same-origin API base with /api prefix."
    open_questions: []
    metrics:
      stages_completed: 35
      chapters_completed: 2
  - status_id: "status-0074"
    timestamp_tashkent: "2026-01-21T17:39:07+05:00"
    current_position:
      chapter_id: "CHAPTER 11"
      stage_id: "STAGE 11.4"
      stage_title: "Migrations + Owner Seed Strategy"
    done:
      summary:
        - "Added explicit SPA fallback to serve index.html for non-API routes."
      details:
        - "Static files are now served directly if present, otherwise index.html is returned."
    next_actions_current_stage: []
    dod_evidence:
      - "backend/app/main.py updated with spa_fallback route."
    decisions:
      - "Use a simple file-existence check for SPA routing instead of StaticFiles mount."
    open_questions: []
    metrics:
      stages_completed: 35
      chapters_completed: 2
  - status_id: "status-0075"
    timestamp_tashkent: "2026-01-21T17:47:33+05:00"
    current_position:
      chapter_id: "CHAPTER 11"
      stage_id: "STAGE 11.4"
      stage_title: "Migrations + Owner Seed Strategy"
    done:
      summary:
        - "Prevented local frontend env from leaking into Docker builds."
      details:
        - "Excluded frontend/.env from Docker build context to avoid localhost API base."
    next_actions_current_stage: []
    dod_evidence:
      - ".dockerignore updated to ignore frontend/.env."
    decisions:
      - "Use same-origin API base in production builds."
    open_questions: []
    metrics:
      stages_completed: 35
      chapters_completed: 2
  - status_id: "status-0076"
    timestamp_tashkent: "2026-01-21T18:01:51+05:00"
    current_position:
      chapter_id: "CHAPTER 11"
      stage_id: "STAGE 11.4"
      stage_title: "Migrations + Owner Seed Strategy"
    done:
      summary:
        - "Added demo links and deployment guidance to README."
      details:
        - "Included demo URL, Docker image link, default credentials, and Docker run examples."
    next_actions_current_stage: []
    dod_evidence:
      - "README.md updated with demo and deployment sections."
    decisions: []
    open_questions: []
    metrics:
      stages_completed: 35
      chapters_completed: 2
