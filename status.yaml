schema_version: "1.0"
project:
  name: "Inventory Management System (MVP)"
  description_ref: "DESCRIPTION.md"
  roadmap_ref: "ROADMAP.md"
  rules_ref: "RULES.md"
  sync_protocol_ref: "SYNC-PROTOCOL.md"

stack:
  backend:
    language: "Python"
    framework: "FastAPI"
    database: "SQLite"
    orm: "SQLAlchemy"
    migrations: "Alembic"
    auth: "JWT in HttpOnly cookie"
  frontend:
    framework: "React or Vue (TBD)"
    api_client: "fetch or axios (TBD)"

status_history:
  - status_id: "status-0001"
    timestamp_tashkent: "2026-01-20T00:00:00+05:00"
    current_position:
      chapter_id: "CHAPTER 1"
      stage_id: "STAGE 1.1"
      stage_title: "Repository & Workspace Setup"
    done:
      summary: []
      details: []
    next_actions_current_stage:
      - "Create monorepo structure: backend/ and frontend/"
      - "Initialize Git repository and add .gitignore"
      - "Add .env.example and minimal README"
    dod_evidence:
      - "No evidence yet (project not started)."
    decisions:
      - "Backend stack selected: FastAPI + SQLAlchemy + Alembic + SQLite."
      - "Frontend stack will be React or Vue (not decided yet)."
      - "Auth approach planned: JWT stored in HttpOnly cookie."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 0
      chapters_completed: 0
  - status_id: "status-0002"
    timestamp_tashkent: "2026-01-20T14:40:00+05:00"
    current_position:
      chapter_id: "CHAPTER 1"
      stage_id: "STAGE 1.2"
      stage_title: "Backend Skeleton (FastAPI)"
    done:
      summary:
        - "Created monorepo structure with backend/ and frontend/ directories."
        - "Added .gitignore, .env.example, and expanded README."
      details:
        - "Initialized repository layout in project root."
        - "Defined environment variable template for app name, secret, DB, and frontend origin."
        - "Documented features and stack in README."
    next_actions_current_stage:
      - "Create FastAPI app entry point."
      - "Add health check endpoint (GET /ping)."
      - "Configure settings module (app name, secret key, DB URL)."
      - "Enable CORS for frontend origin."
    dod_evidence:
      - "backend/ and frontend/ directories present."
      - ".gitignore and .env.example added in repo root."
      - "README updated with project description and features."
    decisions:
      - "Monorepo structure chosen: backend/ + frontend/."
      - "Environment template uses APP_NAME, SECRET_KEY, DATABASE_URL, FRONTEND_ORIGIN."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 1
      chapters_completed: 0
  - status_id: "status-0003"
    timestamp_tashkent: "2026-01-20T14:51:00+05:00"
    current_position:
      chapter_id: "CHAPTER 1"
      stage_id: "STAGE 1.3"
      stage_title: "Database Setup"
    done:
      summary:
        - "Created FastAPI app entry point with CORS enabled."
        - "Added settings module for app configuration."
        - "Implemented health check endpoint."
      details:
        - "FastAPI app initialized with CORS for frontend origin."
        - "Settings read from .env with defaults for app name, secret, DB, and frontend origin."
        - "Health check available at GET /ping."
    next_actions_current_stage:
      - "Configure SQLAlchemy engine + session."
      - "Initialize Alembic migrations."
      - "Create base database structure."
    dod_evidence:
      - "backend/app/main.py created with FastAPI app, CORS, and /ping."
      - "backend/app/core/config.py created with Settings and .env loading."
      - "backend/app/__init__.py created."
    decisions:
      - "FastAPI app uses CORS with single allowed frontend origin from settings."
      - "Settings are loaded via Pydantic BaseSettings."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 2
      chapters_completed: 0
  - status_id: "status-0004"
    timestamp_tashkent: "2026-01-20T15:06:00+05:00"
    current_position:
      chapter_id: "CHAPTER 2"
      stage_id: "STAGE 2.1"
      stage_title: "User Model"
    done:
      summary:
        - "Configured SQLAlchemy engine/session and declarative base."
        - "Initialized Alembic configuration and environment."
        - "Added backend requirements list."
      details:
        - "Created backend/app/db/base.py and backend/app/db/session.py with engine, SessionLocal, and SQLite connect args."
        - "Added backend/alembic.ini, backend/alembic/env.py, backend/alembic/script.py.mako, and backend/alembic/versions/.gitkeep."
        - "Added backend/requirements.txt with core backend dependencies."
    next_actions_current_stage:
      - "Implement User database model."
      - "Add password hashing utilities."
      - "Create admin/owner seed user logic."
    dod_evidence:
      - "backend/app/db/base.py created with declarative Base."
      - "backend/app/db/session.py created with engine and SessionLocal."
      - "backend/alembic.ini created."
      - "backend/alembic/env.py created."
      - "backend/alembic/script.py.mako created."
      - "backend/alembic/versions/.gitkeep created."
      - "backend/requirements.txt created."
    decisions:
      - "SQLAlchemy engine uses sqlite check_same_thread=False when database URL starts with sqlite."
      - "Alembic environment loads database URL from application settings."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 3
      chapters_completed: 1
  - status_id: "status-0005"
    timestamp_tashkent: "2026-01-20T15:16:00+05:00"
    current_position:
      chapter_id: "CHAPTER 2"
      stage_id: "STAGE 2.2"
      stage_title: "Login API"
    done:
      summary:
        - "Implemented User model for authentication."
        - "Added password hashing utilities."
        - "Added admin seed helper and admin credentials config."
      details:
        - "Created backend/app/models/user.py with users table and fields."
        - "Added backend/app/core/security.py with pbkdf2_hmac hashing and verification."
        - "Added backend/app/db/seed.py to create admin user if missing."
        - "Extended backend/app/core/config.py and .env.example with admin credentials."
    next_actions_current_stage:
      - "Implement POST /auth/login."
      - "Issue authentication token (JWT) and store in cookie (HttpOnly)."
      - "Implement GET /auth/me for session validation."
      - "Implement POST /auth/logout to clear authentication cookie."
    dod_evidence:
      - "backend/app/models/user.py created."
      - "backend/app/core/security.py created."
      - "backend/app/db/seed.py created."
      - "backend/app/core/config.py updated with admin credentials."
      - ".env.example updated with admin credentials."
    decisions:
      - "Password hashing uses pbkdf2_hmac with per-user salt."
      - "Admin account seeding is provided via ensure_admin_user helper."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 4
      chapters_completed: 1
  - status_id: "status-0006"
    timestamp_tashkent: "2026-01-20T15:23:00+05:00"
    current_position:
      chapter_id: "CHAPTER 2"
      stage_id: "STAGE 2.3"
      stage_title: "Protected API Access"
    done:
      summary:
        - "Implemented login API with JWT in HttpOnly cookie."
        - "Added session validation and logout endpoints."
        - "Added JWT utilities and request authentication dependency."
      details:
        - "Added backend/app/api/auth.py with /auth/login, /auth/me, /auth/logout."
        - "Added backend/app/core/jwt.py for token creation/decoding and backend/app/core/auth.py for current user dependency."
        - "Added backend/app/db/deps.py for DB session dependency and auth schemas in backend/app/schemas/auth.py."
        - "Extended settings and .env.example with token expiry and added PyJWT dependency."
    next_actions_current_stage:
      - "Create backend dependency for authenticated requests."
      - "Protect all business endpoints behind login."
    dod_evidence:
      - "backend/app/api/auth.py created."
      - "backend/app/core/jwt.py created."
      - "backend/app/core/auth.py created."
      - "backend/app/schemas/auth.py created."
      - "backend/app/main.py updated to include auth router."
      - "backend/requirements.txt updated with PyJWT."
      - "Manual check: .venv/bin/python -c \"from app.db.session import engine; print(engine)\" => Engine(sqlite:///./app.db)."
      - "Manual check: .venv/bin/alembic -c alembic.ini current => Alembic context initialized without errors."
      - "Manual check: .venv/bin/uvicorn app.main:app failed to bind on 127.0.0.1:8000 (port already in use)."
    decisions:
      - "JWT is stored in HttpOnly cookie named access_token."
      - "Token expiration is configurable via ACCESS_TOKEN_EXPIRE_MINUTES."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 5
      chapters_completed: 1
