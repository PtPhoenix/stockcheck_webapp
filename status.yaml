schema_version: "1.0"
project:
  name: "Inventory Management System (MVP)"
  description_ref: "DESCRIPTION.md"
  roadmap_ref: "ROADMAP.md"
  rules_ref: "RULES.md"
  sync_protocol_ref: "SYNC-PROTOCOL.md"

stack:
  backend:
    language: "Python"
    framework: "FastAPI"
    database: "SQLite"
    orm: "SQLAlchemy"
    migrations: "Alembic"
    auth: "JWT in HttpOnly cookie"
  frontend:
    framework: "React or Vue (TBD)"
    api_client: "fetch or axios (TBD)"

status_history:
  - status_id: "status-0001"
    timestamp_tashkent: "2026-01-20T00:00:00+05:00"
    current_position:
      chapter_id: "CHAPTER 1"
      stage_id: "STAGE 1.1"
      stage_title: "Repository & Workspace Setup"
    done:
      summary: []
      details: []
    next_actions_current_stage:
      - "Create monorepo structure: backend/ and frontend/"
      - "Initialize Git repository and add .gitignore"
      - "Add .env.example and minimal README"
    dod_evidence:
      - "No evidence yet (project not started)."
    decisions:
      - "Backend stack selected: FastAPI + SQLAlchemy + Alembic + SQLite."
      - "Frontend stack will be React or Vue (not decided yet)."
      - "Auth approach planned: JWT stored in HttpOnly cookie."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 0
      chapters_completed: 0
  - status_id: "status-0002"
    timestamp_tashkent: "2026-01-20T14:40:00+05:00"
    current_position:
      chapter_id: "CHAPTER 1"
      stage_id: "STAGE 1.2"
      stage_title: "Backend Skeleton (FastAPI)"
    done:
      summary:
        - "Created monorepo structure with backend/ and frontend/ directories."
        - "Added .gitignore, .env.example, and expanded README."
      details:
        - "Initialized repository layout in project root."
        - "Defined environment variable template for app name, secret, DB, and frontend origin."
        - "Documented features and stack in README."
    next_actions_current_stage:
      - "Create FastAPI app entry point."
      - "Add health check endpoint (GET /ping)."
      - "Configure settings module (app name, secret key, DB URL)."
      - "Enable CORS for frontend origin."
    dod_evidence:
      - "backend/ and frontend/ directories present."
      - ".gitignore and .env.example added in repo root."
      - "README updated with project description and features."
    decisions:
      - "Monorepo structure chosen: backend/ + frontend/."
      - "Environment template uses APP_NAME, SECRET_KEY, DATABASE_URL, FRONTEND_ORIGIN."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 1
      chapters_completed: 0
  - status_id: "status-0003"
    timestamp_tashkent: "2026-01-20T14:51:00+05:00"
    current_position:
      chapter_id: "CHAPTER 1"
      stage_id: "STAGE 1.3"
      stage_title: "Database Setup"
    done:
      summary:
        - "Created FastAPI app entry point with CORS enabled."
        - "Added settings module for app configuration."
        - "Implemented health check endpoint."
      details:
        - "FastAPI app initialized with CORS for frontend origin."
        - "Settings read from .env with defaults for app name, secret, DB, and frontend origin."
        - "Health check available at GET /ping."
    next_actions_current_stage:
      - "Configure SQLAlchemy engine + session."
      - "Initialize Alembic migrations."
      - "Create base database structure."
    dod_evidence:
      - "backend/app/main.py created with FastAPI app, CORS, and /ping."
      - "backend/app/core/config.py created with Settings and .env loading."
      - "backend/app/__init__.py created."
    decisions:
      - "FastAPI app uses CORS with single allowed frontend origin from settings."
      - "Settings are loaded via Pydantic BaseSettings."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 2
      chapters_completed: 0
  - status_id: "status-0004"
    timestamp_tashkent: "2026-01-20T15:06:00+05:00"
    current_position:
      chapter_id: "CHAPTER 2"
      stage_id: "STAGE 2.1"
      stage_title: "User Model"
    done:
      summary:
        - "Configured SQLAlchemy engine/session and declarative base."
        - "Initialized Alembic configuration and environment."
        - "Added backend requirements list."
      details:
        - "Created backend/app/db/base.py and backend/app/db/session.py with engine, SessionLocal, and SQLite connect args."
        - "Added backend/alembic.ini, backend/alembic/env.py, backend/alembic/script.py.mako, and backend/alembic/versions/.gitkeep."
        - "Added backend/requirements.txt with core backend dependencies."
    next_actions_current_stage:
      - "Implement User database model."
      - "Add password hashing utilities."
      - "Create admin/owner seed user logic."
    dod_evidence:
      - "backend/app/db/base.py created with declarative Base."
      - "backend/app/db/session.py created with engine and SessionLocal."
      - "backend/alembic.ini created."
      - "backend/alembic/env.py created."
      - "backend/alembic/script.py.mako created."
      - "backend/alembic/versions/.gitkeep created."
      - "backend/requirements.txt created."
    decisions:
      - "SQLAlchemy engine uses sqlite check_same_thread=False when database URL starts with sqlite."
      - "Alembic environment loads database URL from application settings."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 3
      chapters_completed: 1
  - status_id: "status-0005"
    timestamp_tashkent: "2026-01-20T15:16:00+05:00"
    current_position:
      chapter_id: "CHAPTER 2"
      stage_id: "STAGE 2.2"
      stage_title: "Login API"
    done:
      summary:
        - "Implemented User model for authentication."
        - "Added password hashing utilities."
        - "Added admin seed helper and admin credentials config."
      details:
        - "Created backend/app/models/user.py with users table and fields."
        - "Added backend/app/core/security.py with pbkdf2_hmac hashing and verification."
        - "Added backend/app/db/seed.py to create admin user if missing."
        - "Extended backend/app/core/config.py and .env.example with admin credentials."
    next_actions_current_stage:
      - "Implement POST /auth/login."
      - "Issue authentication token (JWT) and store in cookie (HttpOnly)."
      - "Implement GET /auth/me for session validation."
      - "Implement POST /auth/logout to clear authentication cookie."
    dod_evidence:
      - "backend/app/models/user.py created."
      - "backend/app/core/security.py created."
      - "backend/app/db/seed.py created."
      - "backend/app/core/config.py updated with admin credentials."
      - ".env.example updated with admin credentials."
    decisions:
      - "Password hashing uses pbkdf2_hmac with per-user salt."
      - "Admin account seeding is provided via ensure_admin_user helper."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 4
      chapters_completed: 1
  - status_id: "status-0006"
    timestamp_tashkent: "2026-01-20T15:23:00+05:00"
    current_position:
      chapter_id: "CHAPTER 2"
      stage_id: "STAGE 2.3"
      stage_title: "Protected API Access"
    done:
      summary:
        - "Implemented login API with JWT in HttpOnly cookie."
        - "Added session validation and logout endpoints."
        - "Added JWT utilities and request authentication dependency."
      details:
        - "Added backend/app/api/auth.py with /auth/login, /auth/me, /auth/logout."
        - "Added backend/app/core/jwt.py for token creation/decoding and backend/app/core/auth.py for current user dependency."
        - "Added backend/app/db/deps.py for DB session dependency and auth schemas in backend/app/schemas/auth.py."
        - "Extended settings and .env.example with token expiry and added PyJWT dependency."
    next_actions_current_stage:
      - "Create backend dependency for authenticated requests."
      - "Protect all business endpoints behind login."
    dod_evidence:
      - "backend/app/api/auth.py created."
      - "backend/app/core/jwt.py created."
      - "backend/app/core/auth.py created."
      - "backend/app/schemas/auth.py created."
      - "backend/app/main.py updated to include auth router."
      - "backend/requirements.txt updated with PyJWT."
      - "Manual check: .venv/bin/python -c \"from app.db.session import engine; print(engine)\" => Engine(sqlite:///./app.db)."
      - "Manual check: .venv/bin/alembic -c alembic.ini current => Alembic context initialized without errors."
      - "Manual check: .venv/bin/uvicorn app.main:app failed to bind on 127.0.0.1:8000 (port already in use)."
    decisions:
      - "JWT is stored in HttpOnly cookie named access_token."
      - "Token expiration is configurable via ACCESS_TOKEN_EXPIRE_MINUTES."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 5
      chapters_completed: 1
  - status_id: "status-0007"
    timestamp_tashkent: "2026-01-20T15:27:00+05:00"
    current_position:
      chapter_id: "CHAPTER 3"
      stage_id: "STAGE 3.1"
      stage_title: "Product Model"
    done:
      summary:
        - "Added protected router scaffold for authenticated business APIs."
      details:
        - "Created backend/app/api/protected.py with APIRouter dependency on get_current_user."
    next_actions_current_stage:
      - "Implement Product model."
      - "Include per-product low-stock threshold (min_stock)."
      - "Include product-level low-stock enable flag (low_stock_enabled)."
      - "Add soft-delete support (active/inactive)."
    dod_evidence:
      - "backend/app/api/protected.py created."
    decisions:
      - "Business endpoints will use a shared router with get_current_user dependency."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 6
      chapters_completed: 1
  - status_id: "status-0008"
    timestamp_tashkent: "2026-01-20T15:32:36+05:00"
    current_position:
      chapter_id: "CHAPTER 3"
      stage_id: "STAGE 3.2"
      stage_title: "Product CRUD API"
    done:
      summary:
        - "Implemented Product model with low-stock and active flags."
      details:
        - "Added Product SQLAlchemy model with name, unit, min_stock, low_stock_enabled, and is_active fields."
        - "Registered models import for Alembic metadata discovery."
    next_actions_current_stage:
      - "Implement product create endpoint."
      - "Implement product update endpoint."
      - "Implement product delete/deactivate endpoint."
      - "Implement product list endpoint with pagination."
    dod_evidence:
      - "backend/app/models/product.py created."
      - "backend/app/models/__init__.py updated to export Product."
      - "backend/alembic/env.py updated to import app.models."
    decisions:
      - "Product model uses is_active for soft delete and low_stock_enabled to control alerts."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 7
      chapters_completed: 1
  - status_id: "status-0009"
    timestamp_tashkent: "2026-01-20T15:36:57+05:00"
    current_position:
      chapter_id: "CHAPTER 3"
      stage_id: "STAGE 3.3"
      stage_title: "Search Support"
    done:
      summary:
        - "Added Product CRUD API with pagination."
      details:
        - "Implemented create, update, list, and deactivate endpoints under /products."
        - "Added Product request/response schemas with pagination wrapper."
        - "Protected product routes behind authentication dependency."
    next_actions_current_stage:
      - "Add product search by name to list endpoint."
      - "Validate search behavior (case-insensitive, partial match)."
    dod_evidence:
      - "backend/app/api/products.py created with POST/PUT/DELETE/GET endpoints."
      - "backend/app/schemas/product.py created."
      - "backend/app/schemas/__init__.py updated with product schemas."
      - "backend/app/main.py updated to include products router."
    decisions:
      - "Product list endpoint returns paginated items with total, skip, and limit."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 8
      chapters_completed: 1
  - status_id: "status-0010"
    timestamp_tashkent: "2026-01-20T15:37:37+05:00"
    current_position:
      chapter_id: "CHAPTER 4"
      stage_id: "STAGE 4.1"
      stage_title: "Movement Model"
    done:
      summary:
        - "Added product search by name to the list endpoint."
      details:
        - "List endpoint supports case-insensitive partial matching via query parameter."
    next_actions_current_stage:
      - "Implement StockMovement model."
      - "Support movement types: IN and OUT."
      - "Store quantity, timestamp, optional note, created_by."
    dod_evidence:
      - "backend/app/api/products.py updated with search filter on name."
    decisions:
      - "Search uses case-insensitive partial match."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 9
      chapters_completed: 1
  - status_id: "status-0011"
    timestamp_tashkent: "2026-01-20T15:43:14+05:00"
    current_position:
      chapter_id: "CHAPTER 4"
      stage_id: "STAGE 4.2"
      stage_title: "Movement API"
    done:
      summary:
        - "Implemented StockMovement model."
      details:
        - "Added stock_movements table with product_id, movement_type, quantity, note, created_by, and created_at."
    next_actions_current_stage:
      - "Implement POST /movements to create incoming/outgoing movements."
      - "Implement GET /movements list endpoint with basic filters."
    dod_evidence:
      - "backend/app/models/stock_movement.py created."
      - "backend/app/models/__init__.py updated to export StockMovement."
    decisions:
      - "Stock movements reference products and users via foreign keys."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 10
      chapters_completed: 1
  - status_id: "status-0012"
    timestamp_tashkent: "2026-01-20T15:44:26+05:00"
    current_position:
      chapter_id: "CHAPTER 4"
      stage_id: "STAGE 4.3"
      stage_title: "Balance Calculation Service"
    done:
      summary:
        - "Implemented stock movement API with basic filters."
      details:
        - "Added POST /movements to create IN/OUT movements."
        - "Added GET /movements with optional product_id and movement_type filters and pagination."
        - "Added movement schemas for create/list responses."
    next_actions_current_stage:
      - "Implement balance calculation logic: total(IN) âˆ’ total(OUT)."
      - "Provide a backend function to compute balance per product."
      - "Ensure products with no movements return balance = 0."
    dod_evidence:
      - "backend/app/api/movements.py created."
      - "backend/app/schemas/movement.py created."
      - "backend/app/schemas/__init__.py updated with movement schemas."
      - "backend/app/main.py updated to include movements router."
    decisions:
      - "Movement list supports basic filters and pagination."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 11
      chapters_completed: 1
  - status_id: "status-0013"
    timestamp_tashkent: "2026-01-20T15:45:15+05:00"
    current_position:
      chapter_id: "CHAPTER 5"
      stage_id: "STAGE 5.1"
      stage_title: "Stock Overview API"
    done:
      summary:
        - "Implemented balance calculation service."
      details:
        - "Added helper to compute per-product balance as total(IN) minus total(OUT)."
        - "Returns zero balance for products with no movements."
    next_actions_current_stage:
      - "Implement GET /stock/overview endpoint returning product fields + balance + low-stock flag."
      - "Support search, low-stock filter, active filter, sorting, and low-stock-first ordering."
    dod_evidence:
      - "backend/app/services/balance.py created with get_product_balance."
      - "backend/app/services/__init__.py created."
    decisions:
      - "Balance is computed via SQL aggregation with IN/OUT case sums."
    open_questions:
      - "Choose frontend framework: React or Vue."
      - "Choose API client: fetch or axios."
    metrics:
      stages_completed: 12
      chapters_completed: 1
